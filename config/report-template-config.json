{
  "reportMetadata": {
    "title": "TR ONESOURCE Partner Implementation Guide",
    "version": "1.0",
    "audience": "ERP vendors, workflow providers, technology partners integrating TR ONESOURCE APIs"
  },
  "sections": [
    {
      "id": "executive-summary",
      "title": "Executive Summary",
      "order": 1,
      "type": "auto-generated",
      "countrySpecific": false,
      "subsections": [
        "Partner Profile",
        "Project Contacts",
        "Integration Scope",
        "Key Risks & Mitigation",
        "Success Criteria"
      ]
    },
    {
      "id": "country-compliance",
      "title": "Country Compliance Requirements: {country}",
      "order": 2,
      "type": "agent-generated",
      "agent": "ccr",
      "countrySpecific": true,
      "workflowId": "f87b828b-39cb-4a9e-9225-bb9e67ff4860",
      "timeout": 120000,
      "promptTemplate": "ccr-country-compliance",
      "requiredSubsections": [
        "Mandate Overview",
        "Pre-Integration Checklist",
        "Technical Requirements",
        "AR (Outbound) Process",
        "AP (Inbound) Process",
        "Penalties & Sanctions",
        "Critical Dates",
        "Resources"
      ],
      "validation": {
        "mustInclude": ["mandate status", "penalties", "mandatory fields"],
        "mustNotInclude": ["not applicable without explanation"]
      }
    },
    {
      "id": "document-format",
      "title": "Document Format Requirements: {country}",
      "order": 3,
      "type": "agent-generated",
      "agent": "puf",
      "countrySpecific": true,
      "workflowId": "f5a1f931-82f3-4b50-a051-de3e175e3d5f",
      "timeout": 120000,
      "promptTemplate": "puf-document-format",
      "requiredSubsections": [
        "Pagero Universal Format Overview",
        "Country-Specific Field Requirements",
        "Mandatory Fields Mapping",
        "Validation Rules",
        "XML Structure Examples",
        "Common Errors & Solutions"
      ]
    },
    {
      "id": "api-implementation",
      "title": "API Implementation Guide",
      "order": 4,
      "type": "agent-generated",
      "agent": "api",
      "countrySpecific": false,
      "workflowId": "74f9914d-b8c9-44f0-ad5c-13af2d02144c",
      "timeout": 120000,
      "promptTemplate": "api-implementation",
      "requiredSubsections": [
        "Authentication Setup (OAuth 2.0)",
        "Company Management & Multi-Tenancy",
        "AR (Outbound) Flow",
        "AP (Inbound) Flow",
        "Error Handling",
        "Webhooks & Notifications",
        "Code Examples",
        "Best Practices"
      ]
    },
    {
      "id": "testing-validation",
      "title": "Testing & Validation",
      "order": 5,
      "type": "static-template",
      "countrySpecific": false,
      "templateFile": "testing-validation-template.md"
    },
    {
      "id": "production-deployment",
      "title": "Production Deployment",
      "order": 6,
      "type": "static-template",
      "countrySpecific": false,
      "templateFile": "production-deployment-template.md"
    },
    {
      "id": "support-resources",
      "title": "Support & Resources",
      "order": 7,
      "type": "static-template",
      "countrySpecific": false,
      "templateFile": "support-resources-template.md"
    }
  ],
  "promptTemplates": {
    "ccr-country-compliance": "You are generating the Country Compliance Requirements section for {country}.\n\nPartner Context:\n- Company: {partnerCompanyName}\n- Partnership Type: {partnershipType}\n- Invoice Handling: {invoiceHandling} (AR/AP)\n- Monthly Volume: {invoiceVolume}\n\nCRITICAL INSTRUCTIONS:\nExtract the following from CCR documents and your knowledge base:\n\n1. MANDATE OVERVIEW\n   - E-invoicing Status: [Mandatory/Voluntary/Planned]\n   - Scope: [B2B/B2G/B2C]\n   - Implementation Date: [Date]\n   - Model: [CTC/Clearance/Post-Audit/Peppol]\n   - Penalty Range: [Summary]\n\n2. PRE-INTEGRATION CHECKLIST\n   ☐ VAT Registration (format: {format}, example: {example})\n   ☐ Tax ID obtained (name: {name}, format: {format})\n   ☐ Digital Certificate (type: {type}, authority: {authority})\n   ☐ Platform Registration (if required)\n   ☐ Accreditation Test (if self-hosting)\n\n3. TECHNICAL REQUIREMENTS\n   - Communication Protocol: {protocol}\n   - Document Format: {format}\n   - Digital Signature: {type}\n   - Mandatory Fields (list all with formats and validation rules):\n     * Field 1: {name} (format: {format}, validation: {rule})\n     * Field 2: ...\n\n4. AR (OUTBOUND) PROCESS\n   {if invoiceHandling includes 'ar'}\n   Step-by-step process from invoice creation to tax authority clearance:\n   1. {action} - {details}\n   2. {action} - {details}\n   ...\n\n5. AP (INBOUND) PROCESS\n   {if invoiceHandling includes 'ap'}\n   Step-by-step process for receiving invoices:\n   1. {action} - {details}\n   2. {action} - {details}\n   ...\n\n6. PENALTIES & SANCTIONS\n   - Minor Violations: {range} - {examples}\n   - Major Violations: {range} - {examples}\n   - Serious Violations: {range} - {examples}\n\n7. CRITICAL DATES\n   - {Date}: {Event}\n   - {Date}: {Event}\n\n8. RESOURCES\n   - Tax Authority Portal: {URL}\n   - Classification Codes: {URL}\n   - Documentation: {URL}\n\n⚠️ VALIDATION RULES:\n- Do NOT skip any section - if information unavailable, state \"Not specified in available documentation\"\n- Include specific examples and formats (e.g., \"OIB: 11 digits, format: 12345678901\")\n- Highlight CRITICAL items with ⚠️ symbol\n- Use checklists (☐) for actionable items\n- Provide exact penalty amounts when known\n\nFormat output as structured markdown following sections above.",
    "puf-document-format": "You are generating the Document Format Requirements section for {country}.\n\nPartner Context:\n- Systems Integrating: {systemIntegration}\n- Invoice Handling: {invoiceHandling}\n\nCRITICAL INSTRUCTIONS:\nProvide detailed Pagero Universal Format (PUF) requirements for {country}:\n\n1. PAGERO UNIVERSAL FORMAT OVERVIEW\n   - Format: XML-based\n   - Standard: UBL 2.1 compatible\n   - Purpose: Universal format for e-invoicing\n\n2. COUNTRY-SPECIFIC FIELD REQUIREMENTS FOR {country}\n   List all mandatory fields specific to {country}:\n   - Tax ID Type: {type} (format: {format}, example: {example})\n   - Classification Codes: {type} (format: {format}, example: {example})\n   - Country-specific fields: {list}\n\n3. MANDATORY FIELDS MAPPING\n   Create table:\n   | PUF Field | Country Requirement | Format | Validation | Example |\n   |-----------|---------------------|--------|------------|---------|  \n   | TaxID | {requirement} | {format} | {rule} | {example} |\n   ...\n\n4. VALIDATION RULES\n   - Field-level validations:\n     * TaxID: {validation rule}\n     * InvoiceNumber: {validation rule}\n     * Date: {validation rule}\n   - Document-level validations:\n     * {validation rule}\n   - Business rules:\n     * {business rule}\n\n5. XML STRUCTURE EXAMPLES\n   Provide complete PUF XML example for {country} with:\n   - Invoice header\n   - Party information (supplier/buyer)\n   - Line items\n   - Tax calculations\n   - Country-specific extensions\n\n6. COMMON ERRORS & SOLUTIONS\n   List top 10 validation errors and how to fix them:\n   - Error: {error message}\n     Cause: {cause}\n     Solution: {solution}\n\n⚠️ CRITICAL: Focus on {country}-specific requirements. Highlight mandatory vs optional fields.\n\nFormat output as structured markdown with tables and code examples.",
    "api-implementation": "You are generating the API Implementation Guide for a partner integrating with TR ONESOURCE E-Invoicing API.\n\nPartner Context:\n- Company: {partnerCompanyName}\n- Programming Language: {programmingLanguage}\n- Systems: {systemIntegration}\n- Countries: {countriesList}\n- Invoice Handling: {invoiceHandling}\n- Volume: {invoiceVolume}/month\n- Service Model: {serviceModel}\n- Account Access: {accountAccess}\n\nCountry Compliance Context:\n{ccrResponsesSummary}\n\nCRITICAL INSTRUCTIONS:\nProvide comprehensive API implementation guidance covering:\n\n1. AUTHENTICATION SETUP (OAuth 2.0)\n   - Client Credentials Grant (system-to-system)\n   - Authorization Code Grant (user login)\n   - Token management and refresh\n   - Code examples in {programmingLanguage}\n\n2. COMPANY MANAGEMENT & MULTI-TENANCY\n   - Getting companyId\n   - Managing multiple customer accounts\n   - Account access model: {accountAccess}\n\n3. AR (OUTBOUND) FLOW\n   {if invoiceHandling includes 'ar'}\n   Step-by-step API calls:\n   1. POST /documents (submit invoice)\n   2. GET /documents/{id}/status (poll status)\n   3. Handle clearance response\n   4. POST /documents/{id}/fetch (mark as fetched)\n\n   Include:\n   - Complete request/response examples in {programmingLanguage}\n   - Status codes and meanings\n   - Polling strategy recommendations\n   - Error handling for each step\n\n4. AP (INBOUND) FLOW\n   {if invoiceHandling includes 'ap'}\n   Step-by-step API calls:\n   1. GET /documents (poll for new invoices)\n   2. GET /documents/{id} (retrieve details)\n   3. GET /documents/{id}/formats/{format} (download PUF/UBL)\n   4. POST /documents/{id}/response (send business acknowledgment)\n\n   Include complete examples in {programmingLanguage} and error handling\n\n5. ERROR HANDLING STRATEGY\n   - Recipient not found\n   - Validation errors\n   - Clearance rejections\n   - Network failures\n   - Retry logic recommendations\n   - Code examples in {programmingLanguage}\n\n6. WEBHOOKS & NOTIFICATIONS\n   - Setting up webhook endpoints\n   - Event types\n   - Payload structure\n   - Security (signature verification)\n   - Implementation examples in {programmingLanguage}\n\n7. CODE EXAMPLES\n   Provide complete, runnable code in {programmingLanguage}:\n   - Authentication + token management\n   - AR flow (if applicable)\n   - AP flow (if applicable)\n   - Error handling wrapper functions\n   - Retry logic implementation\n\n⚠️ CRITICAL:\n- ALL code examples must be in {programmingLanguage} (except PUF XML which must be UBL XML format)\n- All code examples must be complete and runnable\n- Include error handling in every example\n- Reference country-specific requirements from CCR context\n- Provide actual API endpoint paths\n- Include expected response structures\n- Use language-specific best practices and idioms\n\n8. BEST PRACTICES\n   - Rate limiting considerations\n   - Caching strategies  \n   - Logging and monitoring\n   - Multi-country considerations\n   - Testing approach\n   - Language-specific recommendations for {programmingLanguage}\n\nFormat as structured markdown with code blocks and tables."
  },
  "staticTemplates": {
    "testing-validation": "## Testing & Validation\n\n### Test Environment Setup\n1. **Obtain Test Credentials**\n   - Contact Thomson Reuters support for test environment access\n   - You will receive:\n     - Test API endpoint URL\n     - Test OAuth credentials (client ID & secret)\n     - Test companyId\n\n2. **Configure Test System**\n   ```bash\n   # Set environment variables\n   export TR_API_BASE_URL=\"https://test.onesource.example.com\"\n   export TR_CLIENT_ID=\"your-test-client-id\"\n   export TR_CLIENT_SECRET=\"your-test-client-secret\"\n   ```\n\n### Test Cases\n\n#### Authentication Tests\n☐ Obtain access token using client credentials\n☐ Refresh token before expiration\n☐ Handle token expiration gracefully\n☐ Test invalid credentials error handling\n\n{if invoiceHandling includes 'ar'}\n#### AR (Outbound) Test Cases\n☐ Submit valid invoice to test tax authority\n☐ Poll for clearance status\n☐ Handle approved invoice\n☐ Handle rejected invoice (validation error)\n☐ Handle recipient not found error\n☐ Test invoice with all mandatory fields for {countriesList}\n☐ Test invoice volume: minimum {estimatedTestVolume} invoices\n\n{if invoiceHandling includes 'ap'}\n#### AP (Inbound) Test Cases\n☐ Poll for received invoices\n☐ Download invoice in PUF format\n☐ Download invoice in native format\n☐ Send business acknowledgment (accept)\n☐ Send business acknowledgment (reject)\n☐ Test with invoices from multiple countries\n\n#### Error Handling Tests\n☐ Network timeout\n☐ Invalid document format\n☐ Missing mandatory field\n☐ Duplicate invoice number\n☐ Rate limit exceeded\n\n### Validation Checklist\n\nBefore proceeding to production:\n\n☐ **Functional Validation**\n  - All test cases passed\n  - Error handling tested and verified\n  - Webhook integration tested (if applicable)\n\n☐ **Performance Validation**\n  - API response times acceptable (<2s for submissions)\n  - Can handle expected volume ({invoiceVolume}/month)\n  - Polling frequency optimized\n\n☐ **Security Validation**\n  - Credentials stored securely (not hardcoded)\n  - API tokens encrypted in transit and at rest\n  - Webhook signature verification implemented\n\n☐ **Country Compliance Validation**\n  For each country: {countriesList}\n  - All mandatory fields included\n  - Format validations passing\n  - Tax calculations correct\n  - Digital signature applied (if required)\n\n☐ **Documentation**\n  - API integration documented\n  - Error handling documented\n  - Runbook created for operations team",
    "production-deployment": "## Production Deployment\n\n### Pre-Deployment Checklist\n\n☐ **Credentials**\n  - Production API credentials obtained from Thomson Reuters\n  - Credentials stored in secure vault (not in code)\n  - Access limited to authorized personnel\n\n☐ **Environment Configuration**\n  - Production API endpoint configured\n  - Correct companyId for production\n  - Timeout settings appropriate for production load\n  - Retry logic configured\n\n☐ **Compliance Registration**\n  For each country: {countriesList}\n  - VAT registration completed\n  - Tax ID obtained and verified\n  - Digital certificate installed (if required)\n  - Tax authority platform registration (if required)\n\n☐ **Monitoring Setup**\n  - Application logging configured\n  - Error alerting configured\n  - API usage monitoring\n  - Performance metrics tracking\n\n### Deployment Steps\n\n1. **Deploy to Staging**\n   - Deploy code to staging environment\n   - Run smoke tests\n   - Verify configuration\n\n2. **Production Deployment**\n   - Schedule deployment during low-traffic period\n   - Deploy code to production\n   - Verify API connectivity\n   - Test with single transaction\n\n3. **Go-Live**\n   - Enable for pilot customers first (recommend 1-3 customers)\n   - Monitor closely for 48 hours\n   - Gradually roll out to remaining customers\n\n### Post-Deployment Monitoring\n\n**First 24 Hours:**\n- Monitor error rates (target: <1%)\n- Monitor API response times (target: <2s)\n- Check for clearance rejections\n- Review logs for unexpected errors\n\n**First Week:**\n- Daily review of API usage metrics\n- Daily review of error logs\n- Track clearance success rate by country\n- Gather customer feedback\n\n**Ongoing:**\n- Weekly review of error trends\n- Monthly review of API usage\n- Monitor for API changes/deprecations\n- Stay updated on country compliance changes\n\n### Rollback Plan\n\nIf critical issues occur:\n\n1. **Immediate Actions**\n   - Disable integration via feature flag\n   - Notify affected customers\n   - Preserve error logs\n\n2. **Investigation**\n   - Review error logs\n   - Identify root cause\n   - Determine fix timeline\n\n3. **Resolution**\n   - Deploy fix to staging\n   - Verify fix resolves issue\n   - Re-deploy to production\n   - Re-enable integration\n\n### Support Escalation\n\n**Partner Support:** {firstLineSupport}\n- If \"partner\": Partner provides first-line support, escalates to TR as needed\n- If \"thomson-reuters\": TR provides direct support to end customers\n\n**Escalation Path:**\n1. Level 1: Partner support team\n2. Level 2: Partner technical team\n3. Level 3: Thomson Reuters support (support@onesource.example.com)\n4. Level 4: Thomson Reuters engineering",
    "support-resources": "## Support & Resources\n\n### Thomson Reuters Support\n\n**Technical Support**\n- Email: api-support@tr.com\n- Portal: https://support.thomsonreuters.com\n- Response SLA:\n  - Critical: 2 hours\n  - High: 8 hours\n  - Medium: 24 hours\n\n**Partner Account Manager**\n- Name: [To be assigned]\n- Email: [To be assigned]\n- Scheduled check-ins: Monthly\n\n### Documentation Resources\n\n**API Documentation**\n- Base URL: https://developers.thomsonreuters.com/onesource\n- API Reference: [Link]\n- Integration Guides: [Link]\n- Changelog: [Link]\n\n**Country Compliance Resources**\n{for each country in countriesList}\n- **{country}**\n  - Tax Authority: [Link from CCR]\n  - Classification Codes: [Link from CCR]\n  - Local Documentation: [Link from CCR]\n\n**Developer Tools**\n- Postman Collection: [Link]\n- SDK Libraries:\n  - Python: https://github.com/tr/onesource-python\n  - JavaScript: https://github.com/tr/onesource-js\n  - Java: https://github.com/tr/onesource-java\n- Code Samples: https://github.com/tr/onesource-samples\n\n### Training & Certification\n\n**Available Training**\n- API Integration Workshop (4 hours)\n- Country Compliance Webinars (monthly)\n- Partner Certification Program\n\n**Schedule Training**\nContact: training@tr.com\n\n### Community\n\n**Partner Forum**\n- URL: https://community.thomsonreuters.com/partners\n- Monthly Q&A sessions\n- Best practices sharing\n\n**Office Hours**\n- When: Every Tuesday 10:00-11:00 AM EST\n- Join: [Teams/Zoom link]\n- No registration required\n\n### Status & Maintenance\n\n**System Status**\n- Status Page: https://status.onesource.thomsonreuters.com\n- Subscribe to notifications: [Link]\n\n**Planned Maintenance**\n- Maintenance windows: 2nd Saturday of each month, 2:00-6:00 AM EST\n- Notifications sent 1 week in advance\n\n### Contact Information\n\n**Your Account Team**\n- Project Manager: {projectManagerName} ({projectManagerEmail})\n- Technical Lead: {technicalLeadName} ({technicalLeadEmail})\n- Partnership Type: {partnershipType}\n- Service Model: {serviceModel}\n\n**Report Information**\n- Generated: {generatedDate}\n- Report ID: {reportId}\n- Countries in Scope: {countriesList}\n- Invoice Handling: {invoiceHandling}"
  }
}
